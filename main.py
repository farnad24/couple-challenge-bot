import logging
import sqlite3
import random
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton
import string

# ๐ ุชูุธูุงุช ุงุตู
TOKEN = "Robot Token"
ADMIN_ID = 227975536  # ุขุฏ ุนุฏุฏ ูุฏุฑ
REQUIRED_CHANNEL = "@your_channel"  # ุขุฏ ฺฉุงูุงู ุงุฌุจุงุฑ (ูุซุงู: @your_channel)
CHANNEL_TITLE = "ฺฉุงูุงู ุฑุณู"  # ุนููุงู ฺฉุงูุงู ุจุฑุง ููุงุด ุจู ฺฉุงุฑุจุฑ


# ุฑุงูโุงูุฏุงุฒ ุฑุจุงุช
logging.basicConfig(level=logging.INFO)
bot = Bot(token=TOKEN)
dp = Dispatcher()

# ุงุชุตุงู ุจู ุฏุชุงุจุณ SQLite
conn = sqlite3.connect("partners.db")
cursor = conn.cursor()

# ุงุฌุงุฏ ุฌุฏููโูุง ููุฑุฏูุงุฒ
cursor.execute('''CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY,
    partner_id INTEGER DEFAULT NULL,
    unique_code TEXT UNIQUE,
    waiting_for_code INTEGER DEFAULT 0
)''')

cursor.execute('''CREATE TABLE IF NOT EXISTS questions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    partner_id INTEGER,
    question TEXT,
    answer TEXT DEFAULT NULL
)''')

cursor.execute('''CREATE TABLE IF NOT EXISTS messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sender_id INTEGER,
    receiver_id INTEGER,
    message TEXT DEFAULT NULL,
    media_type TEXT DEFAULT NULL,
    media_id TEXT DEFAULT NULL
)''')

conn.commit()

# ูุณุช ุณูุงูุงุช ฺุงูุด ุจุฑุง ุฒูุฌโูุง
questions = [
    # ุณูุงูุงุช ุนููู ุฑุงุจุทู
    "ุงฺฏุฑ ฺฉ ุขุฑุฒู ุบุฑููฺฉู ุฏุงุดุชุ ฺ ุจูุฏุ",
    "ุจุฒุฑฺฏุชุฑู ุชุฑุณ ุฒูุฏฺฏุช ฺูุ",
    "ุจูุชุฑู ุฎุงุทุฑูโุง ฺฉู ุจุง ูพุงุฑุชูุฑุช ุฏุงุฑ ฺูุ",
    "ุงฺฏุฑ ูโุชููุณุช ฺฉ ฺุฒ ุฑู ุฏุฑ ุฒูุฏฺฏุช ุชุบุฑ ุจุฏุ ฺ ุจูุฏุ",
    "ุงููู ุจุงุฑ ฺฉู ูููุฏ ุนุงุดู ูู ุดุฏุ ฺฉ ุจูุฏุ",
    "ฺู ฺุฒ ุฏุฑ ุฑุงุจุทูโููู ุจุดุชุฑ ุงุฒ ููู ุชู ุฑู ุฎูุดุญุงู ูโฺฉููุ",
    "ุจุฒุฑฺฏุชุฑู ุขุฑุฒูุช ุจุฑุง ุขูุฏูโููู ฺูุ",
    "ฺู ฺุฒ ุฏุฑ ูู ุจุงุนุซ ูุดู ฺฉู ุฏูุณุชู ุฏุงุดุชู ุจุงุดุ",
    "ุงฺฏู ููุท ฺฉ ุฑูุฒ ุงุฒ ุฒูุฏฺฏููู ูููุฏู ุจูุฏุ ุฏูุณุช ุฏุงุดุช ฺุทูุฑ ุจฺฏุฐุฑูููุดุ",
    "ฺฉ ุฎุงุทุฑูโุง ฺฉู ุงุฒ ูู ุฏุงุฑ ู ูฺููุช ูุฑุงููุด ููโฺฉู ฺูุ",
    "ฺุฒ ูุณุช ฺฉู ูโุฎูุง ูู ุชุบุฑุด ุจุฏูุ",
    "ุฏุฑ ููุฑุฏ ูู ฺู ฺุฒ ุฑู ุจุดุชุฑ ุงุฒ ููู ุฏูุณุช ุฏุงุฑุ",
    "ุชุง ุญุงูุง ูฺฉุฑ ฺฉุฑุฏ ฺฉู ุฑุงุจุทูโููู ุจู ูพุงุงู ุจุฑุณูุ ฺุฑุงุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ฺฉู ุชู ุงู ุฑุงุจุทู ุงุญุณุงุณ ุงููุช ฺฉูุ",
    "ุจุฒุฑฺฏุชุฑู ุงูุฏุช ุจุฑุง ุขูุฏู ูุง ฺูุ",
    "ฺู ฺฉุงุฑ ูโุชููู ุงูุฌุงู ุจุฏู ฺฉู ุฑุงุจุทูโููู ุฑู ุจูุชุฑ ฺฉููุ",
    "ฺุฒ ูุณุช ฺฉู ุงุฒุด ูโุชุฑุณ ูู ูุชููุณุช ุจู ูู ุจฺฏุ",
    "ุงฺฏุฑ ูโุชููุณุช ฺฉ ุฑูุฒ ฺฉุงูู ุจุง ูู ุจฺฏุฐุฑููุ ุฏูุณุช ุฏุงุดุช ฺฺฉุงุฑ ฺฉููุ",
    "ุงุฒ ฺฉุฏูู ุนุงุฏุชโูุง ูู ุฎูุดุช ููุงุฏุ",
    "ุงููู ฺุฒ ฺฉู ุฏุฑ ููุฑุฏ ูู ุชูุฌูุช ุฑู ุฌูุจ ฺฉุฑุฏ ฺ ุจูุฏุ",
    
    # ุณูุงูุงุช ุนููโุชุฑ ุฑุงุจุทู
    "ฺู ูุณุฆููโุง ุฏุฑ ุฑุงุจุทูโููู ูุณุช ฺฉู ุงุฒ ุญุฑู ุฒุฏู ุฏุฑ ููุฑุฏุด ุทูุฑู ูุฑุ",
    "ุฏุฑ ฺฉ ุณุงู ุขูุฏูุ ุฎูุฏุช ุฑู ฺฉุฌุง ูโุจูุ ูุง ุฑู ฺฉุฌุง ูโุจูุ",
    "ุชุง ุญุงูุง ุงุญุณุงุณ ฺฉุฑุฏ ฺฉู ูโุฎูุง ุงุฒ ุงู ุฑุงุจุทู ุจุฑูู ุจุฑุ ฺุฑุงุ",
    "ฺู ฺุฒ ุฏุฑ ุฑุงุจุทูโููู ุจุดุชุฑ ุงุฒ ููู ุชู ุฑู ุขุฒุงุฑ ูุฏูุ",
    "ุงฺฏุฑ ูโุชููุณุช ฺฉ ุงุฒ ุชุฑุณโูุงุช ุฑู ุจุง ูู ุจู ุงุดุชุฑุงฺฉ ุจุฐุงุฑุ ฺ ูฺฏูุชุ",
    "ฺฉุฏูู ุชุตูู ูุดุชุฑฺฉููู ูฺฉุฑ ูโฺฉู ุงุดุชุจุงู ุจูุฏูุ",
    "ฺู ฺุฒ ุฏุฑ ููุฑุฏ ูู ูุณุช ฺฉู ูููุฒ ููโุฏูู ูู ุฏูุณุช ุฏุงุฑ ุจุฏููุ",
    "ุจุฒุฑฺฏุชุฑู ุฏุนูุง ฺฉู ุจุง ูู ุฏุงุดุชู ฺ ุจูุฏุ ฺุทูุฑ ูโุชููุณุชู ุจูุชุฑุด ฺฉููุ",
    "ุชุง ุญุงูุง ุจู ูู ุฏุฑูุบ ฺฏูุชุ ฺุฑุงุ",
    "ฺุฒ ูุณุช ฺฉู ูู ูฺฉุฑ ฺฉูู ุฏูุณุช ุฏุงุฑุ ูู ุฏุฑ ูุงูุน ุงุตูุงู ุฏูุณุช ูุฏุงุดุชู ุจุงุดุ",
    "ุงุฒ ฺู ฺุฒ ุฏุฑ ุฑุงุจุทูโููู ูพุดูููุ",
    "ฺฉุฏูู ุนุงุฏุชโูุงู ุจุดุชุฑ ุงุฒ ููู ุงุฐุชุช ูโฺฉููุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ูฺฉุฑ ฺฉู ฺฉู ูุง ุจุฑุง ูู ููุงุณุจ ูุณุชูุ",
    "ฺุฒ ูุณุช ฺฉู ุฏูุณุช ุฏุงุดุชู ุจุงุด ุฏุฑ ููุฑุฏุด ุจุง ูู ุตุญุจุช ฺฉูุ ูู ูุชููุณุชุ",
    "ุงฺฏุฑ ุงูุฑูุฒ ุขุฎุฑู ุฑูุฒ ุฒูุฏฺฏุช ุจูุฏุ ฺู ุญุฑู ุจู ูู ูโุฒุฏุ",
    "ููุช ุนุตุจุงู ูุดุ ุชุฑุฌุญ ูุฏ ุชููุง ุจุงุด ุง ุจุง ูู ุญุฑู ุจุฒูุ",
    "ฺู ฺฉุณ ุฏุฑ ุฒูุฏฺฏุช ุจุดุชุฑู ุชุงุซุฑ ุฑู ุฑู ุดุฎุตุชุช ฺฏุฐุงุดุชูุ",
    "ุจุฏุชุฑู ุฏุฑูุบ ฺฉู ุชุง ุญุงูุง ุจู ูู ฺฏูุช ฺ ุจูุฏูุ",
    "ุชุง ุญุงูุง ุงุฒ ูู ูุงุงูุฏ ุดุฏุ ฺฉู ู ฺุฑุงุ",
    "ฺุทูุฑ ูโุชููู ุจูุชุฑ ุจุง ูู ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ฺฉููุ",
    
    # ุณูุงูุงุช ุฏุฑุจุงุฑู ุขูุฏู
    "ุฎูุฏุช ุฑู ุชุง ฑฐ ุณุงู ุขูุฏู ฺฉุฌุง ูโุจูุ",
    "ุฏูุณุช ุฏุงุฑ ฺูุฏ ุชุง ุจฺู ุฏุงุดุชู ุจุงุดุ",
    "ุจู ุงุฒุฏูุงุฌ ุจุง ูู ูฺฉุฑ ูโฺฉูุ",
    "ุฏูุณุช ุฏุงุฑ ฺฉุฌุง ุฒูุฏฺฏ ฺฉููุ",
    "ุงฺฏุฑ ูุฑุงุฑ ุจุงุดู ุจุง ูู ุงุฒุฏูุงุฌ ฺฉููุ ุนุฑูุณ ุงุฏูโุขูุช ฺุทูุฑูุ",
    "ุจุฒุฑฺฏุชุฑู ูุฏูุช ุจุฑุง ต ุณุงู ุขูุฏู ฺูุ",
    "ุชู ุขูุฏูุ ุฏูุณุช ุฏุงุฑ ฺู ุณุจฺฉ ุฒูุฏฺฏโุง ุฏุงุดุชู ุจุงุดูุ",
    "ุงฺฏุฑ ุฑูุฒ ุจุฎูุงู ุจุง ูู ุฒูุฏฺฏ ฺฉููุ ฺฉุฏูู ฺฉ ุงุฒ ุนุงุฏุชโูุงุช ููฺฉูู ููู ุงุฐุช ฺฉููุ",
    "ุงฺฏุฑ ูู ุดุบู ูพุฏุง ฺฉูู ฺฉู ูุฌุจูุฑ ุจุดู ุจู ุดูุฑ ุฏฺฏูโุง ุจุฑูุ ุชู ฺฺฉุงุฑ ูโฺฉูุ",
    "ุจุฒุฑฺฏุชุฑู ุชุฑุณุช ุฏุฑ ููุฑุฏ ุชุดฺฉู ุฎุงููุงุฏู ฺูุ",
    "ุงฺฏุฑ ฺฉ ุงุฒ ูุง ุจูุงุฑ ุจุดูุ ฺุทูุฑ ุจุง ุงู ููุถูุน ฺฉูุงุฑ ูุงุ",
    "ูฺฉุฑ ูโฺฉู ุชู ุขูุฏู ุจุงุฏ ูุณุฆููุช ูุงู ุฎููู ุจุง ฺฉ ุจุงุดูุ",
    "ุงฺฏู ุจฺูโุฏุงุฑ ุจุดูุ ฺู ุงุฑุฒุดโูุง ูโุฎูุง ุจูุดูู ุงุฏ ุจุฏุ",
    "ุชู ุฒูุฏฺฏ ูุดุชุฑฺฉุ ุงูุชุธุงุฑ ุฏุงุฑ ูุธุงู ุฎููู ฺุทูุฑ ุชูุณู ุจุดูุ",
    "ุงฺฏุฑ ูพุฏุฑ ู ูุงุฏุฑุช ูุงุฒ ุจู ูุฑุงูุจุช ุฏุงุดุชู ุจุงุดูุ ุงูุชุธุงุฑ ุฏุงุฑ ฺฺฉุงุฑ ฺฉููุ",
    "ุชูุงู ุฏุงุฑ ฺฉุฏูู ุณูุชโูุง ุฎุงููุงุฏฺฏุช ุฑู ุงุฏุงูู ุจุฏุ",
    "ุจุฒุฑฺฏุชุฑู ูุฏูุช ุจุฑุง ุฑุงุจุทูโููู ฺูุ",
    "ุฏุฑ ููุฑุฏ ูพุณโุงูุฏุงุฒ ู ุฎุฑุฌ ฺฉุฑุฏู ูพูู ฺู ูุธุฑ ุฏุงุฑุ",
    "ุฏูุณุช ุฏุงุฑ ูพุฑ ุดุฏูููู ฺฉูุงุฑ ูู ฺุทูุฑ ุจุงุดูุ",
    "ุงฺฏุฑ ฺฉ ุงุฒ ูุง ูุฑุตุช ุดุบู ุฎูุจ ูพุฏุง ฺฉูู ฺฉู ุจุงุนุซ ุฏูุฑ ูุง ุจุดูุ ุชุตููุช ฺูุ",
    
    # ุณูุงูุงุช ุตููุงูู ู ุฌูุณ
    "ุฏูุณุช ุฏุงุฑ ุจุดุชุฑ ฺู ฺฉุงุฑ ุฑู ุจุง ูู ุฏุฑ ุฑุงุจุทู ุงูุชุญุงู ฺฉููุ",
    "ุฌุฐุงุจโุชุฑู ฺุฒ ุฏุฑ ููุฑุฏ ูู ุงุฒ ูุธุฑ ุฌุณู ฺูุ",
    "ูุงูุชุฒ ุฌูุณ ฺฉู ุฏูุณุช ุฏุงุฑ ุจุง ูู ุชุฌุฑุจู ฺฉู ฺูุ",
    "ฺุฒ ูุณุช ฺฉู ูู ุฏุฑ ุฑุงุจุทู ุฌูุณ ุงูุฌุงู ูุฏู ู ุฎู ุฏูุณุช ุฏุงุฑุ",
    "ุชุง ุญุงูุง ุฏุฑ ุญู ุฑุงุจุทู ุจุง ูู ุจู ฺฉุณ ุฏฺฏูโุง ูฺฉุฑ ฺฉุฑุฏุ",
    "ุฏูุณุช ุฏุงุฑ ุฑุงุจุทูโููู ุฑู ฺุทูุฑ ูุฌุงูโุงูฺฏุฒุชุฑ ฺฉููุ",
    "ฺฉุฏูู ูุณูุช ุจุฏูุช ุฏูุณุช ุฏุงุฑ ุจุดุชุฑ ููุณ ุจุดูุ",
    "ุฌุง ุฎุงุต ูุณุช ฺฉู ุฏูุณุช ุฏุงุดุชู ุจุงุด ุฑุงุจุทู ุฏุงุดุชู ุจุงุดูุ",
    "ฺุฒ ูุณุช ฺฉู ุฏูุณุช ุฏุงุดุชู ุจุงุด ุฏุฑ ุฑุงุจุทู ุงูุชุญุงู ฺฉู ูู ุฑูุช ูุดุฏู ุจฺฏุ",
    "ุงููู ุจุงุฑ ฺฉู ุจุง ูู ุฑุงุจุทู ุฏุงุดุชุ ฺู ุญุณ ุฏุงุดุชุ",
    "ุงุฒ ูุธุฑ ุชู ุจูุชุฑู ุฑุงุจุทูโุง ฺฉู ุจุง ูู ุฏุงุดุชู ฺฉ ุจูุฏูุ",
    "ุงุฒ ฺุฒ ุชู ุฑุงุจุทูโููู ุฎุฌุงูุช ูโฺฉุดุ",
    "ุงุฒ ูุธุฑ ุนุงุทูุ ฺู ฺุฒ ุจุงุนุซ ูุดู ุจุดุชุฑ ุชุญุฑฺฉ ุจุดุ",
    "ุชุง ุญุงูุง ุจุฏูู ุงูฺฉู ูู ุจุฏูููุ ุงุฒ ฺุฒ ุชู ุฑุงุจุทูโููู ูุฐุช ูุจุฑุฏุ",
    "ุฏูุณุช ุฏุงุฑ ฺูุฏ ููุช ฺฉุจุงุฑ ุฑุงุจุทู ุฏุงุดุชู ุจุงุดูุ",
    "ฺุฒ ูุณุช ฺฉู ูู ุฏุฑ ุฑุงุจุทู ุงูุฌุงู ูุฏู ู ุชู ุฎูุดุช ููุงุฏุ",
    "ุงฺฏุฑ ุจุฎูุง ู ฺุฒ ุฌุฏุฏ ุชู ุฑุงุจุทู ุงูุชุญุงู ฺฉูุ ฺ ุงูุชุฎุงุจ ูโฺฉูุ",
    "ฺู ฺฉููุงุช ุง ุฌูููโูุง ุฏูุณุช ุฏุงุฑ ูููุน ุฑุงุจุทู ุจุดููุ",
    "ุฏูุณุช ุฏุงุฑ ูุจู ุงุฒ ุฑุงุจุทู ฺฺฉุงุฑ ฺฉููุ",
    "ุชุง ุญุงูุง ุชู ุฑุงุจุทูโููู ุจู ฺุฒ ูุงูููุฏ ฺฉุฑุฏุ",
    
    # ุณูุงูุงุช ุดุฎุต ู ุฑูุงูุดูุงุฎุช
    "ุจุฒุฑฺฏุชุฑู ุฒุฎู ุฑูุญโุง ฺฉู ุฏุงุฑ ฺูุ",
    "ฺฉุฏูู ุชุฌุฑุจู ุฒูุฏฺฏุช ุจุดุชุฑ ุงุฒ ููู ุฑูุช ุชุฃุซุฑ ฺฏุฐุงุดุชูุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ููุช ุชููุง ฺฏุฑู ฺฉูุ",
    "ุงุฒ ฺ ุจุดุชุฑ ุงุฒ ููู ุฎุฌุงูุช ูโฺฉุดุ",
    "ุณุฎุชโุชุฑู ฺุฒ ฺฉู ุชุง ุญุงูุง ุจู ฺฉุณ ฺฏูุช ฺ ุจูุฏูุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ุงุญุณุงุณ ุดฺฉุณุช ฺฉูุ",
    "ุขุง ุชุง ุญุงูุง ูฺฉุฑ ุฎูุฏฺฉุด ุฏุงุดุชุ",
    "ุขุง ุชุง ุญุงูุง ุจู ฺฉุณ ุฎุงูุช ฺฉุฑุฏุ",
    "ฺู ุงุชูุงู ุชู ุจฺฺฏ ุงูุชุงุฏู ฺฉู ูููุฒ ุฑูุช ุชุฃุซุฑ ุฏุงุฑูุ",
    "ฺู ฺุฒ ุชู ุฒูุฏฺฏ ุจุงุนุซ ูุดู ุงุญุณุงุณ ฺฏูุงู ฺฉูุ",
    "ุงุฒ ฺู ฺุฒ ุฏุฑ ุฎูุฏุช ุจุดุชุฑ ุงุฒ ููู ุดุฑููุฏูโุงุ",
    "ุงฺฏู ุจุชูู ู ุฑุงุฒ ุฑู ุงุฒ ูู ูุฎู ูฺฏู ุฏุงุฑุ ฺ ูุจูุฏุ",
    "ฺุฒ ูุณุช ฺฉู ูโุฎูุง ูู ุฏุฑ ููุฑุฏุด ุจุดุชุฑ ุฏุฑฺฉุช ฺฉููุ",
    "ฺฉุฏูู ุจุฎุด ุงุฒ ุดุฎุตุชุช ุฑู ุฏูุณุช ูุฏุงุฑ ุฏฺฏุฑุงู ุจุจููุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ุญุณ ฺฉู ฺฉู ุฒูุฏฺฏุช ุงุฑุฒุดููุฏูุ",
    "ููุช ุญุงูุช ุจุฏูุ ุชุฑุฌุญ ูุฏ ุชููุง ุจุงุด ุง ูพุด ููุ",
    "ฺู ฺุฒ ุจุดุชุฑ ุงุฒ ููู ุงุนุชูุงุฏ ุจู ููุณุช ุฑู ุงุฒ ุจู ูโุจุฑูุ",
    "ฺุทูุฑ ูโุชููู ุจูุช ฺฉูฺฉ ฺฉูู ููุช ุญุงูุช ุฎูุจ ูุณุชุ",
    "ฺู ฺฉุงุฑ ูโุชููู ุงูุฌุงู ุจุฏู ฺฉู ุจุดุชุฑ ุงุญุณุงุณ ุงููุช ฺฉูุ",
    "ุจุฒุฑฺฏุชุฑู ููุทู ุถุนูุช ฺูุ",
    
    # ุณูุงูุงุช ุฏุฑ ููุฑุฏ ฺฏุฐุดุชู
    "ุชูุฎโุชุฑู ุฎุงุทุฑู ุฒูุฏฺฏุช ฺูุ",
    "ุฑุงุจุทู ูุจูุช ฺุทูุฑ ุชููู ุดุฏุ",
    "ฺุฒ ุฏุฑ ฺฏุฐุดุชูโุงุช ูุณุช ฺฉู ุงุฒ ูู ูพููุงู ฺฉุฑุฏู ุจุงุดุ",
    "ุจุฏุชุฑู ุงุดุชุจุงู ฺฉู ุชู ุฒูุฏฺฏุช ฺฉุฑุฏ ฺ ุจูุฏูุ",
    "ฺฉุณ ุชู ฺฏุฐุดุชู ูุณุช ฺฉู ูููุฒ ุจูุด ูฺฉุฑ ฺฉูุ",
    "ฺุฒ ุฏุฑ ฺฏุฐุดุชูโุงุช ูุณุช ฺฉู ุขุฑุฒู ฺฉู ูู ูฺููุช ูููููุ",
    "ุงุฒ ฺฉุฏูู ุจุฎุด ุฒูุฏฺฏุช ุจุดุชุฑ ูพุดูููุ",
    "ุงฺฏู ูโุชููุณุช ุจู ฺฏุฐุดุชู ุจุฑฺฏุฑุฏุ ฺู ฺุฒ ุฑู ุชุบุฑ ูโุฏุงุฏุ",
    "ุฏุฑุจุงุฑู ุฑุงุจุทูโูุง ูุจูุช ฺุฒ ูุณุช ฺฉู ูู ูุฏูููุ",
    "ฺฉุฏูู ุฎุงุทุฑู ุงุฒ ุจฺฺฏุช ุจุดุชุฑ ุงุฒ ููู ุฏูุณุช ุฏุงุฑุ",
    "ฺุฒ ูุณุช ฺฉู ุชู ฺฏุฐุดุชู ุงุชูุงู ุงูุชุงุฏู ุจุงุดู ู ูููุฒ ุฑูุช ุชุฃุซุฑ ุฏุงุดุชู ุจุงุดูุ",
    "ฺู ุฏุฑูุบ ุจู ุฎุงููุงุฏูโุงุช ฺฏูุช ฺฉู ูููุฒ ููโุฏููู ุญููุช ฺูุ",
    "ุชู ฺฏุฐุดุชู ฺฉุงุฑ ุจุฏ ฺฉุฑุฏ ฺฉู ฺฉุณ ููโุฏูููุ",
    "ุชุง ุญุงูุง ฺฉุณ ุฑู ูุงูุนุงู ุงุฒ ุชู ุฏู ุจุฎุดุฏุ",
    "ุจุฏุชุฑู ุดฺฉุณุช ฺฉู ุฎูุฑุฏ ฺ ุจูุฏูุ",
    "ุงููู ุจูุณูโุงุช ุจุง ฺฉ ุจูุฏุ",
    "ุงููู ุนุดูุช ฺฉ ุจูุฏ ู ฺุฑุง ุชููู ุดุฏุ",
    "ฺู ุงุชูุงู ุชู ุฒูุฏฺฏุช ุงูุชุงุฏู ฺฉู ุจุงุนุซ ุดุฏู ุขุฏู ูุชูุงูุช ุจุดุ",
    "ฺู ฺฉุณ ุฏุฑ ฺฏุฐุดุชู ุจุดุชุฑู ุขุณุจ ุฑู ุจูุช ุฒุฏูุ",
    "ุงฺฏู ุจุดู ู ููุฑ ุงุฒ ฺฏุฐุดุชูโุงุช ุฑู ุฏูุจุงุฑู ุจุจูุ ฺฉ ุฑู ุงูุชุฎุงุจ ูโฺฉูุ",
    
    # ุณูุงูุงุช ูุงูุชุฒ ู ูุงุฌุฑุงุฌู
    "ุงฺฏู ุจุฑุง ฺฉ ุฑูุฒ ูุงูุฑุฆ ุจูุฏุ ฺฺฉุงุฑ ูโฺฉุฑุฏุ",
    "ุงฺฏู ูโุชููุณุช ู ุงุจุฑูุฏุฑุช ุฏุงุดุชู ุจุงุดุ ฺ ุงูุชุฎุงุจ ูโฺฉุฑุฏุ",
    "ุงฺฏู ุฏูุง ูุฑุฏุง ุชููู ูโุดุฏุ ุขุฎุฑู ฺฉุงุฑ ฺฉู ุจุง ูู ูโฺฉุฑุฏ ฺ ุจูุฏุ",
    "ุฌุณูุฑุงููโุชุฑู ฺฉุงุฑ ฺฉู ุฏูุณุช ุฏุงุฑ ุจุง ูู ุงูุฌุงู ุจุฏ ฺูุ",
    "ุฏูุณุช ุฏุงุฑ ฺฉุฌุง ุณูุฑ ฺฉูู ฺฉู ุชุง ุญุงูุง ูุฑูุชูุ",
    "ุฏูุณุช ุฏุงุฑ ฺู ูุงุฌุฑุงุฌู ุฑู ุจุง ูู ุชุฌุฑุจู ฺฉููุ",
    "ูุฌุงูโุงูฺฏุฒุชุฑู ฺุฒ ฺฉู ุฏูุณุช ุฏุงุฑ ุงูุชุญุงู ฺฉู ฺูุ",
    "ุณู ฺุฒ ฺฉู ุฏูุณุช ุฏุงุฑ ูุจู ุงุฒ ูุฑฺฏุช ุงูุฌุงู ุจุฏ ฺูุ",
    "ุงฺฏุฑ ูพูู ูุดฺฉู ูุจูุฏุ ฺฉุฌุง ุฒูุฏฺฏ ูโฺฉุฑุฏุ",
    "ุงฺฏู ูโุชููุณุช ูุฑ ฺุฒ ุฑู ุฏุฑ ุฏูุง ุชุบุฑ ุจุฏุ ฺ ุฑู ุงูุชุฎุงุจ ูโฺฉุฑุฏุ",
    "ุงฺฏู ูโุชููุณุช ุจุง ู ุดุฎุตุช ูุดููุฑ ุดุงู ุจุฑุ ฺฉ ุฑู ุงูุชุฎุงุจ ูโฺฉุฑุฏุ",
    "ุงฺฏู ูุฑุงุฑ ุจูุฏ ููุท ฺฉ ูุณูู ุฑู ุจู ู ุฌุฒุฑู ูุชุฑูฺฉ ุจุจุฑุ ฺ ุงูุชุฎุงุจ ูโฺฉุฑุฏุ",
    "ุฌุณูุฑุงููโุชุฑู ฺฉุงุฑ ฺฉู ุชุง ุญุงูุง ุงูุฌุงู ุฏุงุฏ ฺ ุจูุฏูุ",
    "ุงฺฏู ูโุชููุณุช ู ุงุฎุชุฑุงุน ุงูุฌุงู ุจุฏุ ฺ ุงุฎุชุฑุงุน ูโฺฉุฑุฏุ",
    "ุงฺฏู ู ูุงู ููุช ุขุฒุงุฏ ุฏุงุดุชุ ฺฺฉุงุฑ ูโฺฉุฑุฏุ",
    "ุจูุชุฑู ุฑูุฒ ุฒูุฏฺฏุช ฺุทูุฑ ูโฺฏุฐุดุชุ",
    "ุงฺฏู ูโุชููุณุช ุจุง ูุฑ ฺฉุณ ููุงูุงุช ฺฉูุ ฺฉ ุฑู ุงูุชุฎุงุจ ูโฺฉุฑุฏุ",
    "ุงฺฏู ูโุชููุณุช ุชู ูุฑ ุฏูุฑูโุง ุงุฒ ุชุงุฑุฎ ุฒูุฏฺฏ ฺฉูุ ฺฉุฏูู ุฏูุฑู ุฑู ุงูุชุฎุงุจ ูโฺฉุฑุฏุ",
    "ุงฺฏู ู ููุงุฑุฏ ุชููู ุจูุช ุจุฏูุ ุจุง ุงููู ุตุฏ ููููุด ฺฺฉุงุฑ ูโฺฉูุ",
    "ุฎุทุฑูุงฺฉโุชุฑู ฺฉุงุฑ ฺฉู ุญุงุถุฑ ุงูุฌุงู ุจุฏ ฺูุ",
    
    # ุณูุงูุงุช ุฏุฑ ููุฑุฏ ุงุญุณุงุณุงุช ุนูู
    "ฺู ูููุนโูุง ุจุดุชุฑ ุงุญุณุงุณ ุชููุง ูโฺฉูุ ุญุช ููุช ุจุง ููุ",
    "ุนููโุชุฑู ุชุฑุณ ฺฉู ุฏุงุฑ ฺู ู ฺุฑุงุ",
    "ฺฉุฏูู ุงุญุณุงุณ ุฑู ุณุฎุชโุชุฑ ุงุฒ ููู ูโุชูู ุงุจุฑุงุฒ ฺฉูุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ฺฉู ุงุญุณุงุณ ฺฉู ุฏูุณุช ุฏุงุดุชู ููุดุ",
    "ุงุฒ ฺู ฺุฒ ุจุดุชุฑ ุงุฒ ููู ุฎุฌุงูุช ูโฺฉุดุ",
    "ุขุฎุฑู ุจุงุฑ ฺฉู ฺฏุฑู ฺฉุฑุฏ ฺฉู ุจูุฏ ู ุจุฑุง ฺุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ูุณุจุช ุจู ูู ุงุญุณุงุณ ูุงุงูู ฺฉูุ",
    "ฺุทูุฑ ูโุชููู ููุช ูุงุฑุงุญุชุ ุจูุชุฑ ุจูุช ฺฉูฺฉ ฺฉููุ",
    "ฺู ฺฉุงุฑ ูุชููู ุงูุฌุงู ุจุฏู ฺฉู ุจุดุชุฑ ุงุญุณุงุณ ฺฉู ุฏูุณุชุช ุฏุงุฑูุ",
    "ฺู ฺุฒ ุจุงุนุซ ูุดู ุงุญุณุงุณ ฺฉู ฺฉู ูุงูุนุงู ุฒูุฏูโุงุ",
    "ุจุฒุฑฺฏุชุฑู ูฺฏุฑุงูุช ุฏุฑ ููุฑุฏ ุขูุฏู ฺูุ",
    "ฺู ูููุนโูุง ุงุญุณุงุณ ุขุฑุงูุด ูโฺฉูุ",
    "ฺู ฺฉุงุฑ ูู ุงูุฌุงู ูุฏู ฺฉู ูุงุฎูุฏุขฺฏุงู ุงุฐุชุช ูโฺฉููุ",
    "ุจุฒุฑฺฏุชุฑู ุฏูู ฺฉู ุจุงุนุซ ูุดู ุจุฎูุง ุจุง ูู ุจููู ฺูุ",
    "ฺุฒ ูุณุช ฺฉู ุฏูุณุช ุฏุงุดุชู ุจุงุด ุจุดุชุฑ ุงุฒ ูู ุจุดููุ",
    "ุงุฒ ฺู ฺุฒูุง ุนููุงู ูพุดูููุ",
    "ฺู ูููุนโูุง ุจุดุชุฑ ุงุฒ ููู ุงุญุณุงุณ ูโฺฉู ฺฉู ุฏูุณุชุช ุฏุงุฑูุ",
    "ฺุทูุฑ ูโุชููู ููุช ุนุตุจุงู ูุณุชุ ุจูุชุฑ ฺฉูฺฉุช ฺฉููุ",
    "ููุช ุจุง ููุ ุงุฒ ฺู ฺุฒ ูโุชุฑุณุ",
    "ุนููโุชุฑู ุขุฑุฒูุช ฺฉู ุชุง ุญุงูุง ุจู ฺฉุณ ูฺฏูุช ฺูุ",
    
    # ุณูุงูุงุช ุฏุฑ ููุฑุฏ ูุณุงุฆู ุญุณุงุณ
    "ูุธุฑุช ุฏุฑ ููุฑุฏ ูุฑุฒูุฏุฎูุงูุฏู ฺฏุฑูุชู ฺูุ",
    "ุงฺฏู ฺฉ ุงุฒ ูุง ูุชููู ุจฺูโุฏุงุฑ ุจุดูุ ฺู ุงุญุณุงุณ ุฎูุงู ุฏุงุดุชุ",
    "ุจู ูุธุฑุช ูุณุงุฆู ูุงู ุจุงุฏ ุจู ุฒูุฌโูุง ฺุทูุฑ ูุฏุฑุช ุจุดูุ",
    "ุฏุฑ ููุฑุฏ ุฑูุงุจุท ุจุงุฒ ฺู ูุธุฑ ุฏุงุฑุ",
    "ุงฺฏู ูู ุจู ูุดฺฉู ุฌุฏ ุณูุงูุช ุจุฑุฎูุฑุฏ ฺฉููุ ฺู ูุงฺฉูุด ูุดูู ูุฏุ",
    "ูุธุฑุช ุฏุฑ ููุฑุฏ ูุฐูุจ ู ููุดุด ุชู ุฒูุฏฺฏ ูุดุชุฑฺฉููู ฺูุ",
    "ุงฺฏู ูู ุชุบุฑ ุนูุฏู ุณุงุณ ุจุฏูุ ฺู ูุงฺฉูุด ูุดูู ูุฏุ",
    "ฺูุฏุฑ ุจุฑุงุช ูููู ฺฉู ุฎุงููุงุฏูโุงุช ูู ุฑู ุชุฃุฏ ฺฉููุ",
    "ุงฺฏู ูู ู ุงุดุชุจุงู ุจุฒุฑฺฏ ูุฑุชฺฉุจ ุจุดูุ ฺูุฏุฑ ูโุชูู ูู ุฑู ุจุจุฎุดุ",
    "ุงฺฏู ุจุฎูุงู ุดุบูู ุฑู ุนูุถ ฺฉููุ ฺู ูุงฺฉูุด ูุดูู ูุฏุ",
    "ุงฺฏู ูู ุจู ุงูุณุฑุฏฺฏ ุง ุงุถุทุฑุงุจ ูุจุชูุง ุจุดูุ ฺุทูุฑ ฺฉูฺฉู ูโฺฉูุ",
    "ุฏุฑ ููุฑุฏ ูุณุงุฆู ุญุณุงุณ ูุซู ุทูุงู ฺู ูุธุฑ ุฏุงุฑุ",
    "ุงฺฏู ฺฉ ุงุฒ ูุฒุฏฺฉุงูุช ุจุง ูู ูุดฺฉู ุฏุงุดุชู ุจุงุดูุ ฺฺฉุงุฑ ูโฺฉูุ",
    "ุขุง ุญุงุถุฑ ุจู ุฎุงุทุฑ ูู ุงุฒ ุจุฑุฎ ุงูุฏุงูุช ุฏุณุช ุจฺฉุดุ",
    "ุขุง ุฏุฑ ููุฑุฏ ุฏุงุดุชู ุญุณุงุจ ุจุงูฺฉ ูุดุชุฑฺฉ ุงุญุณุงุณ ุฑุงุญุช ูโฺฉูุ",
    "ุงฺฏู ฺฉ ุงุฒ ูุง ุจุงุฏ ุงุฒ ุดูุฑ ุฏฺฏูโุง ฺฉุงุฑ ฺฉููุ ฺุทูุฑ ุฑุงุจุทูโููู ุฑู ูุฏุฑุช ูโฺฉููุ",
    "ุฏุฑ ููุฑุฏ ุฑุงุจุทู ุจุง ุฌูุณ ูุฎุงูู ููุช ุชู ุฑุงุจุทู ูุณุช ฺู ูุธุฑ ุฏุงุฑุ",
    "ุจู ูุธุฑุช ุตุญุจุช ุจุง ูพุงุฑุชูุฑ ูุจู ูุงุจู ูุจููู ุง ููุ",
    "ุขุง ุญุงุถุฑ ุจุนุฏ ุงุฒ ุงุฒุฏูุงุฌ ูุญู ุฒูุฏฺฏุช ุฑู ุชุบุฑ ุจุฏุ",
    "ุงฺฏู ูู ุจุฎูุงู ุณุจฺฉ ุฒูุฏฺฏู ุฑู ุจู ุทูุฑ ุงุณุงุณ ุชุบุฑ ุจุฏูุ ฺู ูุงฺฉูุด ูุดูู ูุฏุ",
    
    # ุณูุงูุงุช ุฏุฑ ููุฑุฏ ุฑุดุฏ ุดุฎุต
    "ฺู ฺุฒ ุฏุฑ ููุฑุฏ ุฎูุฏุช ุฏูุณุช ุฏุงุฑ ุชุบุฑ ุจุฏุ",
    "ุจุฒุฑฺฏุชุฑู ูุฏู ฺฉู ุฏุงุฑ ฺู ู ฺุทูุฑ ูโุฎูุง ุจูุด ุจุฑุณุ",
    "ฺุทูุฑ ูโุชููู ุจูุช ฺฉูฺฉ ฺฉูู ุชุง ุจู ูุฏูโูุงุช ุจุฑุณุ",
    "ฺู ุนุงุฏุช ุจุฏ ุฏุงุฑ ฺฉู ูโุฎูุง ุชุฑฺฉุด ฺฉูุ",
    "ฺุทูุฑ ูโุชููู ููุฏฺฏู ุฑู ุจุฑุง ุฑุดุฏ ุดุฎุต ุชุดูู ฺฉููุ",
    "ฺู ููุงุฑุชโูุง ุฏูุณุช ุฏุงุฑ ุงุฏ ุจฺฏุฑุ",
    "ุจู ูุธุฑุช ูู ฺู ฺุฒ ูโุชููู ุงุฒ ุชู ุงุฏ ุจฺฏุฑูุ",
    "ฺู ููุงุท ููุช ุชู ูู ูโุจู ฺฉู ุฎูุฏู ูุชูุฌูุดูู ูุณุชูุ",
    "ฺฉุฏูู ฺฉ ุงุฒ ููุงุท ุถุนูุช ุฑู ุฏูุณุช ุฏุงุฑ ุจูุจูุฏ ุจุฏุ",
    "ฺุทูุฑ ูโุชููู ุจู ููููุช ุชู ฺฉูฺฉ ฺฉููุ",
    "ฺู ฺุฒ ุชู ุฑุงุจุทูโููู ุจุงุนุซ ูุดู ฺฉู ุฑุดุฏ ฺฉูุ",
    "ฺ ุจุงุนุซ ูุดู ุงุญุณุงุณ ููููุช ฺฉูุ",
    "ฺุทูุฑ ูโุชููู ุจู ุนููุงู ู ุฒูุฌ ุฑุดุฏ ฺฉููุ",
    "ุจุฒุฑฺฏุชุฑู ุฏุฑุณ ฺฉู ุงุฒ ุฑุงุจุทูโููู ฺฏุฑูุช ฺูุ",
    "ฺู ฺุฒ ูู ูโุชููู ุงุฒ ุชู ุงุฏ ุจฺฏุฑูุ",
    "ฺู ฺฉุชุงุจ ุฎููุฏ ฺฉู ุฒูุฏฺฏุช ุฑู ุชุบุฑ ุฏุงุฏูุ",
    "ฺุทูุฑ ูโุชููู ุฏุฑ ุฌูุช ุฑุดุฏ ุดุฎุตุช ุจูุช ฺฉูฺฉ ฺฉููุ",
    "ุงุฒ ูุธุฑ ูุนููุ ฺู ุชุฌุฑุจูโุง ุจุฑุงุช ููู ุจูุฏูุ",
    "ฺู ฺุฒ ุชู ุฒูุฏฺฏุช ูโุฎูุง ุจุดุชุฑ ุฏุงุดุชู ุจุงุดุ",
    "ุงุฒ ูุธุฑ ุงุญุณุงุณุ ฺฉุฏูู ุจุฎุด ุงุฒ ุดุฎุตุชุช ุฑู ูโุฎูุง ุจูุจูุฏ ุจุฏุ"
]

def generate_unique_code():
    """ ุชููุฏ ฺฉุฏ ฺฉุชุง ุจุฑุง ฺฉุงุฑุจุฑ """
    return ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))

async def check_subscription(user_id):
    """ ุจุฑุฑุณ ูุถุนุช ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู ุงุฌุจุงุฑ """
    try:
        member = await bot.get_chat_member(REQUIRED_CHANNEL, user_id)
        return member.status in ["member", "administrator", "creator"]
    except Exception as e:
        logging.error(f"ุฎุทุง ุฏุฑ ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ {user_id}: {e}")
        return False

def get_subscription_keyboard():
    """ ุงุฌุงุฏ ุฏฺฉูู ุจุฑุง ุนุถูุช ุฏุฑ ฺฉุงูุงู """
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text=f"๐ ุนุถูุช ุฏุฑ {CHANNEL_TITLE}", url=f"https://t.me/{REQUIRED_CHANNEL.replace('@', '')}")],
            [InlineKeyboardButton(text="โ ุจุฑุฑุณ ูุฌุฏุฏ ุนุถูุช", callback_data="check_subscription")]
        ]
    )
    return keyboard

async def check_user_subscription(message: types.Message):
    """ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ู ุงุฑุณุงู ูพุงู ุฏุฑ ุตูุฑุช ุนุฏู ุนุถูุช"""
    user_id = message.from_user.id
    is_subscribed = await check_subscription(user_id)
    
    if not is_subscribed:
        subscription_keyboard = get_subscription_keyboard()
        await message.answer(
            f"โ๏ธ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุชุ ุงุจุชุฏุง ุจุงุฏ ุฏุฑ ฺฉุงูุงู {CHANNEL_TITLE} ุนุถู ุดูุฏ.",
            reply_markup=subscription_keyboard
        )
        return False
    
    return True

async def send_question(user_id, partner_id):
    """ ุงุฑุณุงู ุณูุงู ฺุงูุด ุจู ุฏู ูพุงุฑุชูุฑ """
    
    # ุจุฑุฑุณ ุขุง ฺฉุงุฑุจุฑุงู ุณูุงู ุจโูพุงุณุฎ ุฏุงุฑูุฏ
    cursor.execute("SELECT id, question FROM questions WHERE user_id = ? AND partner_id = ? AND answer IS NULL", (user_id, partner_id))
    unanswered_user = cursor.fetchone()
    
    cursor.execute("SELECT id, question FROM questions WHERE user_id = ? AND partner_id = ? AND answer IS NULL", (partner_id, user_id))
    unanswered_partner = cursor.fetchone()
    
    # ุงฺฏุฑ ฺฉุงุฑุจุฑ ุงุตู ุณูุงู ุจโูพุงุณุฎ ุฏุงุฑุฏุ ุงุฏุขูุฑ ุงุฑุณุงู ฺฉู
    if unanswered_user:
        question_id, previous_question = unanswered_user
        await bot.send_message(user_id, f"๐ฌ ุงุฏุขูุฑ: ุดูุง ูููุฒ ุจู ุงู ุณูุงู ูพุงุณุฎ ูุฏุงุฏูโุงุฏ:\n\n{previous_question}\n\nโ๏ธ ูุทูุงู ูพุงุณุฎ ุฎูุฏ ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
    
    # ุงฺฏุฑ ูพุงุฑุชูุฑ ุณูุงู ุจโูพุงุณุฎ ุฏุงุฑุฏุ ุงุฏุขูุฑ ุงุฑุณุงู ฺฉู
    if unanswered_partner:
        question_id, previous_question = unanswered_partner
        await bot.send_message(partner_id, f"๐ฌ ุงุฏุขูุฑ: ุดูุง ูููุฒ ุจู ุงู ุณูุงู ูพุงุณุฎ ูุฏุงุฏูโุงุฏ:\n\n{previous_question}\n\nโ๏ธ ูุทูุงู ูพุงุณุฎ ุฎูุฏ ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
    
    # ุงฺฏุฑ ูุฑ ุฏู ฺฉุงุฑุจุฑ ุจู ุณูุงูุงุช ูุจู ูพุงุณุฎ ุฏุงุฏูโุงูุฏุ ุณูุงู ุฌุฏุฏ ุงุฑุณุงู ฺฉู
    if not unanswered_user and not unanswered_partner:
        question = random.choice(questions)
        
        # ุงุฌุงุฏ ุณูุงู ุฌุฏุฏ ุจุฑุง ูุฑ ุฏู ฺฉุงุฑุจุฑ
        cursor.execute("INSERT INTO questions (user_id, partner_id, question) VALUES (?, ?, ?)", (user_id, partner_id, question))
        question_id_1 = cursor.lastrowid
        
        cursor.execute("INSERT INTO questions (user_id, partner_id, question) VALUES (?, ?, ?)", (partner_id, user_id, question))
        question_id_2 = cursor.lastrowid
        
        conn.commit()
        
        # ุงุฑุณุงู ุณูุงู ุจู ฺฉุงุฑุจุฑุงู
        await bot.send_message(user_id, f"๐ฌ ุณูุงู ุฌุฏุฏ: {question}\nโ๏ธ ูพุงุณุฎ ุฎูุฏ ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
        await bot.send_message(partner_id, f"๐ฌ ุณูุงู ุฌุฏุฏ: {question}\nโ๏ธ ูพุงุณุฎ ุฎูุฏ ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
        
        # ุงุฑุณุงู ูพุงู ุจู ุงุฏูู
        await bot.send_message(ADMIN_ID, f"๐ ุณูุงู ุฌุฏุฏ ุจู ฺฉุงุฑุจุฑุงู {user_id} ู {partner_id} ุงุฑุณุงู ุดุฏ:\n{question}")
        
        return True
    
    return False

async def scheduled_questions():
    """ ุงุฑุณุงู ุณูุงู ูุฑ ฒ ุณุงุนุช ฺฉ ุจุงุฑ """
    while True:
        cursor.execute("SELECT user_id, partner_id FROM users WHERE partner_id IS NOT NULL")
        pairs = cursor.fetchall()
        
        # ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุฑุณุงู ุณูุงู ุชฺฉุฑุงุฑ ุจู ุฒูุฌโูุง
        processed_pairs = set()
        
        for user_id, partner_id in pairs:
            # ุงุฌุงุฏ ฺฉ ฺฉูุฏ ููุญุตุฑ ุจู ูุฑุฏ ุจุฑุง ูุฑ ุฒูุฌ (ุจุง ูุฑุชุจโุณุงุฒ ุดูุงุณูโูุง)
            pair_key = tuple(sorted([user_id, partner_id]))
            
            # ุงฺฏุฑ ุงู ุฒูุฌ ูุจูุงู ูพุฑุฏุงุฒุด ูุดุฏูโุงูุฏุ ุณูุงู ุฑุง ุงุฑุณุงู ฺฉู
            if pair_key not in processed_pairs:
                await send_question(user_id, partner_id)
                processed_pairs.add(pair_key)
        
        await asyncio.sleep(7200)  # ูุฑ ฒ ุณุงุนุช

@dp.message(Command("start"))
async def start(message: types.Message):
    """ ุซุจุชโูุงู ู ุงุฌุงุฏ ฺฉุฏ ุงุฎุชุตุงุต """
    user_id = message.from_user.id
    
    # ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู
    is_subscribed = await check_subscription(user_id)
    if not is_subscribed:
        subscription_keyboard = get_subscription_keyboard()
        await message.answer(
            f"ุณูุงู {message.from_user.first_name}!\n\nโ๏ธ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุชุ ุงุจุชุฏุง ุจุงุฏ ุฏุฑ ฺฉุงูุงู {CHANNEL_TITLE} ุนุถู ุดูุฏ.",
            reply_markup=subscription_keyboard
        )
        return
    
    # ุงุฏุงูู ุฑููุฏ ูุนููู
    cursor.execute("SELECT unique_code, partner_id FROM users WHERE user_id=?", (user_id,))
    user_data = cursor.fetchone()

    if not user_data:
        unique_code = generate_unique_code()
        cursor.execute("INSERT INTO users (user_id, unique_code) VALUES (?, ?)", (user_id, unique_code))
        conn.commit()
        partner_id = None
    else:
        unique_code, partner_id = user_data

    partner_status = "โ ูฺ ูพุงุฑุชูุฑ ูุฏุงุฑุฏ." if not partner_id else f"โ ุดูุง ูุชุตู ูุณุชุฏ ุจู: [{partner_id}](tg://user?id={partner_id})"

    # ุงุฌุงุฏ ุฏฺฉููโูุง ููู ุงุตู
    menu = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="/connect - ๐ ุงุชุตุงู ุจู ูพุงุฑุชูุฑ")],
            [KeyboardButton(text="/manage - ๐ค ูุฏุฑุช ูพุงุฑุชูุฑ")],
            [KeyboardButton(text="/status - ๐ ูุดุงูุฏู ูุถุนุช")],
        ],
        resize_keyboard=True
    )

    await message.answer(
        f"ุณูุงู {message.from_user.first_name}!\n\n๐ **ฺฉุฏ ุงุฎุชุตุงุต ุดูุง:** {unique_code}\n๐จ ุงู ฺฉุฏ ุฑุง ุจุฑุง ูพุงุฑุชูุฑุช ุจูุฑุณุช ุชุง ูุชุตู ุดูุฏ.\n\n{partner_status}\n\n"
        f"ุจุฑุง ุงุชุตุงู ุจู ูพุงุฑุชูุฑ ุฑู ุฏฺฉูู '/connect - ๐ ุงุชุตุงู ุจู ูพุงุฑุชูุฑ' ฺฉูฺฉ ฺฉูุฏ ุง ุฏุณุชูุฑ /connect ุฑุง ุงุฑุณุงู ฺฉูุฏ.",
        parse_mode="Markdown", reply_markup=menu
    )
    
    # ุงุทูุงุน ุจู ุงุฏูู
    await bot.send_message(
        ADMIN_ID, 
        f"๐ ฺฉุงุฑุจุฑ ุฌุฏุฏ:\nูุงู: {message.from_user.first_name}\nุขุฏ: {user_id}\nูุฒุฑูู: @{message.from_user.username or 'ูุฏุงุฑุฏ'}"
    )

@dp.message(Command("connect"))
async def connect_partner_cmd(message: types.Message):
    """ ูุฏุฑุช ุฏุฑุฎูุงุณุช ุงุชุตุงู ุจู ูพุงุฑุชูุฑ """
    # ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู
    if not await check_user_subscription(message):
        return
    
    user_id = message.from_user.id
    cursor.execute("SELECT partner_id FROM users WHERE user_id=?", (user_id,))
    partner = cursor.fetchone()
    
    if partner and partner[0]:
        await message.answer("โ๏ธ ุดูุง ุฏุฑ ุญุงู ุญุงุถุฑ ุจู ฺฉ ูพุงุฑุชูุฑ ูุชุตู ูุณุชุฏ. ุจุฑุง ุงุชุตุงู ุจู ูพุงุฑุชูุฑ ุฌุฏุฏุ ุงุจุชุฏุง ุงุฑุชุจุงุท ูุนู ุฑุง ูุทุน ฺฉูุฏ.")
        return
    
    # ูุนุงู ฺฉุฑุฏู ุญุงูุช ุงูุชุธุงุฑ ุจุฑุง ฺฉุฏ
    cursor.execute("UPDATE users SET waiting_for_code = 1 WHERE user_id = ?", (user_id,))
    conn.commit()
    
    await message.answer("๐ ูุทูุงู ฺฉุฏ ุงุฎุชุตุงุต ูพุงุฑุชูุฑ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ:")

@dp.message(Command("manage"))
async def manage_partner_cmd(message: types.Message):
    """ ูุฏุฑุช ูพุงุฑุชูุฑ """
    # ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู
    if not await check_user_subscription(message):
        return
    
    user_id = message.from_user.id
    cursor.execute("SELECT partner_id FROM users WHERE user_id=?", (user_id,))
    partner = cursor.fetchone()
    
    if not partner or not partner[0]:
        await message.answer("โ๏ธ ุดูุง ูููุฒ ุจู ูพุงุฑุชูุฑ ูุชุตู ูุดุฏูโุงุฏ.")
        return
    
    # ุงุฌุงุฏ ุฏฺฉูู ุจุฑุง ูุทุน ุงุฑุชุจุงุท
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="โ ูุทุน ุงุฑุชุจุงุท ุจุง ูพุงุฑุชูุฑ", callback_data="disconnect_partner")]
        ]
    )
    
    await message.answer("๐ ูุฏุฑุช ูพุงุฑุชูุฑ:", reply_markup=keyboard)

@dp.callback_query(lambda c: c.data == "disconnect_partner")
async def disconnect_partner(callback: types.CallbackQuery):
    """ ูุทุน ุงุฑุชุจุงุท ุจุง ูพุงุฑุชูุฑ """
    user_id = callback.from_user.id
    cursor.execute("SELECT partner_id FROM users WHERE user_id=?", (user_id,))
    partner = cursor.fetchone()
    
    if partner and partner[0]:
        partner_id = partner[0]
        
        # ูุทุน ุงุฑุชุจุงุท ุฏู ุทุฑูู
        cursor.execute("UPDATE users SET partner_id = NULL WHERE user_id = ?", (user_id,))
        cursor.execute("UPDATE users SET partner_id = NULL WHERE user_id = ?", (partner_id,))
        conn.commit()
        
        await callback.message.edit_text("โ ุงุฑุชุจุงุท ุดูุง ุจุง ูพุงุฑุชูุฑ ูุทุน ุดุฏ.")
        await bot.send_message(partner_id, "โ๏ธ ูพุงุฑุชูุฑ ุดูุง ุงุฑุชุจุงุท ุฑุง ูุทุน ฺฉุฑุฏ.")
        
        # ุงุทูุงุน ุจู ุงุฏูู
        await bot.send_message(ADMIN_ID, f"๐ ฺฉุงุฑุจุฑ {user_id} ุงุฑุชุจุงุท ุฎูุฏ ุฑุง ุจุง ฺฉุงุฑุจุฑ {partner_id} ูุทุน ฺฉุฑุฏ.")
    else:
        await callback.message.edit_text("โ๏ธ ุดูุง ุจู ูพุงุฑุชูุฑ ูุชุตู ูุณุชุฏ.")
    
    await callback.answer()

@dp.callback_query(lambda c: c.data == "check_subscription")
async def check_subscription_callback(callback: types.CallbackQuery):
    """ ุจุฑุฑุณ ูุฌุฏุฏ ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู """
    user_id = callback.from_user.id
    is_subscribed = await check_subscription(user_id)
    
    if is_subscribed:
        await callback.message.edit_text("โ ุนุถูุช ุดูุง ุฏุฑ ฺฉุงูุงู ุชุงุฏ ุดุฏ. ุญุงูุง ูโุชูุงูุฏ ุงุฒ ุฑุจุงุช ุงุณุชูุงุฏู ฺฉูุฏ!")
        await callback.answer("โ ุนุถูุช ุชุงุฏ ุดุฏ")
        
        # ุงุฑุณุงู ููู ุงุตู
        menu = ReplyKeyboardMarkup(
            keyboard=[
                [KeyboardButton(text="/connect - ๐ ุงุชุตุงู ุจู ูพุงุฑุชูุฑ")],
                [KeyboardButton(text="/manage - ๐ค ูุฏุฑุช ูพุงุฑุชูุฑ")],
                [KeyboardButton(text="/status - ๐ ูุดุงูุฏู ูุถุนุช")],
            ],
            resize_keyboard=True
        )
        await callback.message.answer("๐ฎ ููู ุงุตู:", reply_markup=menu)
    else:
        await callback.answer("โ ุดูุง ูููุฒ ุนุถู ฺฉุงูุงู ูุดุฏูโุงุฏ", show_alert=True)

@dp.message(Command("status"))
async def show_status_cmd(message: types.Message):
    """ ููุงุด ูุถุนุช ฺฉุงุฑุจุฑ """
    # ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู
    if not await check_user_subscription(message):
        return
    
    user_id = message.from_user.id
    cursor.execute("SELECT unique_code, partner_id FROM users WHERE user_id=?", (user_id,))
    user_data = cursor.fetchone()
    
    if not user_data:
        await message.answer("โ๏ธ ุงุทูุงุนุงุช ุดูุง ุฏุฑ ุณุณุชู ุงูุช ูุดุฏ. ูุทูุงู ุฏูุจุงุฑู /start ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
        return
    
    unique_code, partner_id = user_data
    
    # ุจุฑุฑุณ ุชุนุฏุงุฏ ฺุงูุด ูุง ูพุงุณุฎ ุฏุงุฏู ุดุฏู
    cursor.execute("SELECT COUNT(*) FROM questions WHERE user_id = ? AND answer IS NOT NULL", (user_id,))
    answered_challenges = cursor.fetchone()[0]
    
    partner_status = "โ ูฺ ูพุงุฑุชูุฑ ูุฏุงุฑุฏ." if not partner_id else f"โ ูุชุตู ุจู ูพุงุฑุชูุฑ: [{partner_id}](tg://user?id={partner_id})"
    
    await message.answer(
        f"๐ **ูุถุนุช ุดูุง:**\n\n"
        f"๐ ุขุฏ ุดูุง: `{user_id}`\n"
        f"๐ ฺฉุฏ ุงุฎุชุตุงุต: `{unique_code}`\n"
        f"๐ฏ ุชุนุฏุงุฏ ฺุงูุดโูุง ูพุงุณุฎ ุฏุงุฏู ุดุฏู: {answered_challenges}\n\n"
        f"{partner_status}",
        parse_mode="Markdown"
    )

@dp.message()
async def process_message(message: types.Message):
    """ ูุฏุฑุช ูพุงูโูุง ู ูพุงุณุฎโูุง ฺฉุงุฑุจุฑุงู """
    user_id = message.from_user.id
    
    # ุจุฑุฑุณ ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู
    is_subscribed = await check_subscription(user_id)
    if not is_subscribed:
        subscription_keyboard = get_subscription_keyboard()
        await message.answer(
            f"โ๏ธ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุชุ ุงุจุชุฏุง ุจุงุฏ ุฏุฑ ฺฉุงูุงู {CHANNEL_TITLE} ุนุถู ุดูุฏ.",
            reply_markup=subscription_keyboard
        )
        return
    
    # ุจุฑุฑุณ ูุถุนุช ฺฉุงุฑุจุฑ
    cursor.execute("SELECT partner_id, waiting_for_code FROM users WHERE user_id=?", (user_id,))
    user_data = cursor.fetchone()
    
    if not user_data:
        await message.answer("โ๏ธ ุงุทูุงุนุงุช ุดูุง ุฏุฑ ุณุณุชู ุงูุช ูุดุฏ. ูุทูุงู ุฏูุจุงุฑู /start ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
        return
    
    partner_id, waiting_for_code = user_data
    
    # ุงฺฏุฑ ฺฉุงุฑุจุฑ ููุชุธุฑ ูุฑูุฏ ฺฉุฏ ุงุณุช
    if waiting_for_code == 1:
        code = message.text.strip() if message.text else None
        
        if code:
            cursor.execute("SELECT user_id FROM users WHERE unique_code=?", (code,))
            potential_partner = cursor.fetchone()
            
            if potential_partner:
                await process_partner_connection(message, potential_partner[0])
            else:
                await message.answer("โ ฺฉุฏ ูุงุฑุฏ ุดุฏู ุตุญุญ ูุณุช. ูุทูุงู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ ุง /start ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
            
            # ุฎุฑูุฌ ุงุฒ ุญุงูุช ุงูุชุธุงุฑ ุจุฑุง ฺฉุฏ
            cursor.execute("UPDATE users SET waiting_for_code = 0 WHERE user_id = ?", (user_id,))
            conn.commit()
        else:
            await message.answer("โ๏ธ ูุทูุงู ฺฉ ฺฉุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ ุง /start ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
        
        return
    
    # ุจุฑุฑุณ ูุชู ุฏฺฉููโูุง
    if message.text:
        if message.text.startswith("/connect") or "ุงุชุตุงู ุจู ูพุงุฑุชูุฑ" in message.text:
            await connect_partner_cmd(message)
            return
        elif message.text.startswith("/manage") or "ูุฏุฑุช ูพุงุฑุชูุฑ" in message.text:
            await manage_partner_cmd(message)
            return
        elif message.text.startswith("/status") or "ูุดุงูุฏู ูุถุนุช" in message.text:
            await show_status_cmd(message)
            return
    
    # ุจุฑุฑุณ ุงูฺฉู ุขุง ฺฉุงุฑุจุฑ ูููุฒ ูพุงุฑุชูุฑ ูุฏุงุฑุฏ
    if not partner_id:
        await message.answer("โ ุดูุง ูููุฒ ุจู ูพุงุฑุชูุฑ ูุชุตู ูุดุฏูโุงุฏ. ูุทูุงู ุงุจุชุฏุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชูุฑ /connect ุง ุฏฺฉูู ูุฑุจูุทู ุจู ฺฉ ูพุงุฑุชูุฑ ูุชุตู ุดูุฏ.")
        return
    
    # ุจุฑุฑุณ ุงูฺฉู ุขุง ุงู ูพุงู ูพุงุณุฎ ุจู ุณูุงู ุงุณุช ุง ฺุช ุนุงุฏ
    cursor.execute("SELECT id, question FROM questions WHERE user_id = ? AND partner_id = ? AND answer IS NULL", (user_id, partner_id))
    question_data = cursor.fetchone()
    
    if question_data:
        question_id, question_text = question_data
        answer_text = None
        media_type = None
        media_id = None
        
        # ุงุณุชุฎุฑุงุฌ ูุชู ูพุงุณุฎ ุงุฒ ุงููุงุน ูุฎุชูู ูพุงู
        if message.text:
            answer_text = message.text
        elif message.caption:
            answer_text = message.caption
            
        if message.photo:
            media_type = "photo"
            media_id = message.photo[-1].file_id
        elif message.video:
            media_type = "video"
            media_id = message.video.file_id
        elif message.voice:
            media_type = "voice"
            media_id = message.voice.file_id
        elif message.video_note:
            media_type = "video_note"
            media_id = message.video_note.file_id
        
        # ุฐุฎุฑู ูพุงุณุฎ ุฏุฑ ุฏุชุงุจุณ
        cursor.execute("UPDATE questions SET answer = ? WHERE id = ?", (answer_text, question_id))
        conn.commit()
        
        await message.answer("โ ูพุงุณุฎ ุดูุง ุจู ฺุงูุด ุฐุฎุฑู ุดุฏ.")
        
        # ุจุฑุฑุณ ุขุง ูพุงุฑุชูุฑ ูู ูพุงุณุฎ ุฏุงุฏู ุงุณุช
        cursor.execute("SELECT answer FROM questions WHERE user_id = ? AND partner_id = ? AND question = ?", 
                       (partner_id, user_id, question_text))
        partner_answer = cursor.fetchone()
        
        if partner_answer and partner_answer[0]:  # ุงฺฏุฑ ูพุงุฑุชูุฑ ูพุงุณุฎ ุฏุงุฏู ุจุงุดุฏ
            # ุงุฑุณุงู ูพุงุณุฎ ูพุงุฑุชูุฑ ุจู ฺฉุงุฑุจุฑ
            await bot.send_message(user_id, 
                                  f"๐ฏ ูุฑ ุฏู ููุฑ ุจู ฺุงูุด ูพุงุณุฎ ุฏุงุฏุฏ! ูพุงุณุฎ ูพุงุฑุชูุฑ ุดูุง:\n\n"
                                  f"โ ุณูุงู: {question_text}\n"
                                  f"๐ฌ ูพุงุณุฎ ูพุงุฑุชูุฑ: {partner_answer[0]}")
            
            # ุงุฑุณุงู ูพุงุณุฎ ฺฉุงุฑุจุฑ ุจู ูพุงุฑุชูุฑ
            await bot.send_message(partner_id, 
                                 f"๐ฏ ูุฑ ุฏู ููุฑ ุจู ฺุงูุด ูพุงุณุฎ ุฏุงุฏุฏ! ูพุงุณุฎ ูพุงุฑุชูุฑ ุดูุง:\n\n"
                                 f"โ ุณูุงู: {question_text}\n"
                                 f"๐ฌ ูพุงุณุฎ ูพุงุฑุชูุฑ: {answer_text}")
            
            # ุงฺฏุฑ ูุฏุง ูุฌูุฏ ุฏุงุฑุฏุ ุขู ุฑุง ูุฒ ุจุฑุง ูพุงุฑุชูุฑ ุงุฑุณุงู ฺฉู
            if media_type and media_id:
                if media_type == "photo":
                    await bot.send_photo(partner_id, media_id, caption="๐ท ุชุตูุฑ ูพุงุณุฎ ูพุงุฑุชูุฑ ุดูุง")
                elif media_type == "video":
                    await bot.send_video(partner_id, media_id, caption="๐ฌ ูุฏู ูพุงุณุฎ ูพุงุฑุชูุฑ ุดูุง")
                elif media_type == "voice":
                    await bot.send_voice(partner_id, media_id, caption="๐ค ุตุฏุง ูพุงุณุฎ ูพุงุฑุชูุฑ ุดูุง")
                elif media_type == "video_note":
                    await bot.send_video_note(partner_id, media_id)
        else:
            # ุงุทูุงุน ุจู ูพุงุฑุชูุฑ ฺฉู ฺฉ ูพุงุณุฎ ุฏุฑุงูุช ุดุฏู ุงุณุช
            await bot.send_message(partner_id, 
                                 f"โ๏ธ ูพุงุฑุชูุฑ ุดูุง ุจู ฺุงูุด ูพุงุณุฎ ุฏุงุฏู ุงุณุช.\n\n"
                                 f"โ ุณูุงู: {question_text}\n\n"
                                 f"โ๏ธ ุดูุง ูููุฒ ูพุงุณุฎ ูุฏุงุฏูโุงุฏ. ูพุงุณุฎ ุฏูุฏ ุชุง ูพุงุณุฎ ูพุงุฑุชูุฑุชุงู ุฑุง ุจุจูุฏ.")
                
        # ุงุทูุงุน ุจู ุงุฏูู
        admin_notification = f"๐ ฺฉุงุฑุจุฑ {user_id} ุจู ฺุงูุด ูพุงุณุฎ ุฏุงุฏ:\n"
        admin_notification += f"ุณูุงู: {question_text}\n"
        admin_notification += f"ูพุงุณุฎ: {answer_text or 'ุจุฏูู ูุชู'}"
        
        await bot.send_message(ADMIN_ID, admin_notification)
        
        # ุงุฑุณุงู ูุฏุง ุจู ุงุฏูู ุงฺฏุฑ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ
        if media_type and media_id:
            admin_media_caption = f"๐ ูุฏุง ูพุงุณุฎ ฺุงูุด ุงุฒ ฺฉุงุฑุจุฑ {user_id} ุจู ุณูุงู: {question_text}"
            
            if media_type == "photo":
                await bot.send_photo(ADMIN_ID, media_id, caption=admin_media_caption)
            elif media_type == "video":
                await bot.send_video(ADMIN_ID, media_id, caption=admin_media_caption)
            elif media_type == "voice":
                await bot.send_voice(ADMIN_ID, media_id, caption=admin_media_caption)
            elif media_type == "video_note":
                await bot.send_message(ADMIN_ID, f"๐ ฺฉุงุฑุจุฑ {user_id} ฺฉ ูุฏู ูุณุฌ ุฏุฑ ูพุงุณุฎ ุจู ฺุงูุด ุงุฑุณุงู ฺฉุฑุฏ")
                await bot.send_video_note(ADMIN_ID, media_id)
        
        return
    
    # ูพุฑุฏุงุฒุด ูพุงู ุนุงุฏ
    message_text = None
    media_type = None
    media_id = None
    
    if message.text:
        message_text = message.text
    elif message.caption:
        message_text = message.caption
    
    if message.photo:
        media_type = "photo"
        media_id = message.photo[-1].file_id
    elif message.video:
        media_type = "video"
        media_id = message.video.file_id
    elif message.voice:
        media_type = "voice"
        media_id = message.voice.file_id
    elif message.video_note:
        media_type = "video_note"
        media_id = message.video_note.file_id
    elif message.sticker:
        media_type = "sticker"
        media_id = message.sticker.file_id
    
    # ุฐุฎุฑู ูพุงู ุฏุฑ ุฏุชุงุจุณ
    cursor.execute(
        "INSERT INTO messages (sender_id, receiver_id, message, media_type, media_id) VALUES (?, ?, ?, ?, ?)",
        (user_id, partner_id, message_text, media_type, media_id)
    )
    conn.commit()
    
    # ุงุฑุณุงู ูพุงู ุจู ูพุงุฑุชูุฑ
    if message_text:
        await bot.send_message(partner_id, f"๐ฌ **ูพุงู ุฌุฏุฏ ุงุฒ ูพุงุฑุชูุฑุช:**\n{message_text}")
    
    # ุงุฑุณุงู ูุฏุง ุจู ูพุงุฑุชูุฑ
    if media_type and media_id:
        caption = "๐ฉ ูุฏุง ุงุฒ ุทุฑู ูพุงุฑุชูุฑ ุดูุง"
        if message_text:
            caption = message_text
            
        if media_type == "photo":
            await bot.send_photo(partner_id, media_id, caption=caption)
        elif media_type == "video":
            await bot.send_video(partner_id, media_id, caption=caption)
        elif media_type == "voice":
            await bot.send_voice(partner_id, media_id, caption=caption)
        elif media_type == "video_note":
            await bot.send_video_note(partner_id, media_id)
        elif media_type == "sticker":
            await bot.send_sticker(partner_id, media_id)
    
    # ุงุฑุณุงู ฺฉูพ ูพุงู ุจู ุงุฏูู
    admin_message = f"๐ ูพุงู ุงุฒ ฺฉุงุฑุจุฑ {user_id} ุจู {partner_id}:"
    if message_text:
        admin_message += f"\n{message_text}"
    else:
        admin_message += f"\n[{media_type}]"
    
    await bot.send_message(ADMIN_ID, admin_message)
    
    # ุงุฑุณุงู ูุฏุง ุจู ุงุฏูู
    if media_type and media_id:
        admin_media_caption = f"๐ ูุฏุง ุงุฒ ฺฉุงุฑุจุฑ {user_id} ุจู ฺฉุงุฑุจุฑ {partner_id}"
        if message_text:
            admin_media_caption += f"\nูพุงู: {message_text}"
            
        if media_type == "photo":
            await bot.send_photo(ADMIN_ID, media_id, caption=admin_media_caption)
        elif media_type == "video":
            await bot.send_video(ADMIN_ID, media_id, caption=admin_media_caption)
        elif media_type == "voice":
            await bot.send_voice(ADMIN_ID, media_id, caption=admin_media_caption)
        elif media_type == "video_note":
            await bot.send_message(ADMIN_ID, f"๐ ฺฉุงุฑุจุฑ {user_id} ฺฉ ูุฏู ูุณุฌ ุจุฑุง ฺฉุงุฑุจุฑ {partner_id} ุงุฑุณุงู ฺฉุฑุฏ")
            await bot.send_video_note(ADMIN_ID, media_id)
        elif media_type == "sticker":
            await bot.send_message(ADMIN_ID, f"๐ ฺฉุงุฑุจุฑ {user_id} ฺฉ ุงุณุชฺฉุฑ ุจุฑุง ฺฉุงุฑุจุฑ {partner_id} ุงุฑุณุงู ฺฉุฑุฏ")
            await bot.send_sticker(ADMIN_ID, media_id)

async def process_partner_connection(message: types.Message, partner_id: int):
    """ ุงุชุตุงู ุฏู ฺฉุงุฑุจุฑ ุจู ฺฉุฏฺฏุฑ """
    user_id = message.from_user.id
    
    # ุจุฑุฑุณ ุงูฺฉู ุขุง ุฎูุฏ ฺฉุงุฑุจุฑ ุงุณุช
    if user_id == partner_id:
        await message.answer("โ ุดูุง ููโุชูุงูุฏ ุจู ุฎูุฏุชุงู ูุชุตู ุดูุฏ!")
        return
    
    # ุจุฑุฑุณ ุงูฺฉู ุขุง ูพุงุฑุชูุฑ ูุจูุงู ุจู ฺฉุณ ูุชุตู ุงุณุช
    cursor.execute("SELECT partner_id FROM users WHERE user_id=?", (partner_id,))
    partner_data = cursor.fetchone()
    
    if partner_data and partner_data[0]:
        await message.answer("โ ฺฉุงุฑุจุฑ ููุฑุฏ ูุธุฑ ูุจูุงู ุจู ูพุงุฑุชูุฑ ุฏฺฏุฑ ูุชุตู ุดุฏู ุงุณุช.")
        return
    
    # ุจุฑุฑุณ ุงูฺฉู ุขุง ฺฉุงุฑุจุฑ ูุจูุงู ุจู ฺฉุณ ูุชุตู ุงุณุช
    cursor.execute("SELECT partner_id FROM users WHERE user_id=?", (user_id,))
    user_data = cursor.fetchone()
    
    if user_data and user_data[0]:
        await message.answer("โ ุดูุง ูุจูุงู ุจู ูพุงุฑุชูุฑ ุฏฺฏุฑ ูุชุตู ุดุฏูโุงุฏ. ุงุจุชุฏุง ุงุฑุชุจุงุท ูุนู ุฑุง ูุทุน ฺฉูุฏ.")
        return

    # ุงุชุตุงู ุฏู ุทุฑูู
    cursor.execute("UPDATE users SET partner_id = ? WHERE user_id = ?", (partner_id, user_id))
    cursor.execute("UPDATE users SET partner_id = ? WHERE user_id = ?", (user_id, partner_id))
    conn.commit()

    await message.answer("โ ุดูุง ู ูพุงุฑุชูุฑุชุงู ุจุง ููููุช ูุชุตู ุดุฏุฏ!")
    await bot.send_message(partner_id, f"โ ฺฉุงุฑุจุฑ {user_id} ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉุฏ ุดูุง ูุชุตู ุดุฏ!")

    # ุงุทูุงุน ุจู ุงุฏูู
    await bot.send_message(
        ADMIN_ID, 
        f"๐ ุงุชุตุงู ุฌุฏุฏ: ฺฉุงุฑุจุฑ {user_id} ุจู ฺฉุงุฑุจุฑ {partner_id} ูุชุตู ุดุฏ."
    )
    
    # ุงุฑุณุงู ุงููู ุณูุงู ฺุงูุด
    await send_question(user_id, partner_id)

async def main():
    # ุดุฑูุน ุชุณฺฉ ุงุฑุณุงู ุณูุงูุงุช ุฒูุงูโุจูุฏ ุดุฏู
    asyncio.create_task(scheduled_questions())
    
    # ุดุฑูุน ูพุงูุณูฺฏ ุฑุจุงุช
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main()) 
